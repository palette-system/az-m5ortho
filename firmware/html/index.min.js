function $(n){return document.getElementById(n)}function show(n,t){$(n)&&($(n).style.display=t?t:"block")}function hide(n){$(n)&&($(n).style.display="none")}function set_html(n,t){$(n).innerHTML=t}function obj_clone(n){return JSON.parse(JSON.stringify(n))}function obj_eq(n,t){return JSON.stringify(n)==JSON.stringify(t)}function ajax(n,t,i){var r=new XMLHttpRequest;r.open("GET",n,!0);r.responseType=t;r.setRequestHeader("Pragma","no-cache");r.setRequestHeader("Cache-Control","no-cache");r.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT");r.onreadystatechange=function(){r.readyState<4||(r.status==200?i(!0,r.response):i(!1,r))};r.send()}function ajax_post(n,t,i){var r=new XMLHttpRequest;r.open("POST",n,!0);r.setRequestHeader("Content-Type","text/plain");r.setRequestHeader("Pragma","no-cache");r.setRequestHeader("Cache-Control","no-cache");r.setRequestHeader("If-Modified-Since","Thu, 01 Jun 1970 00:00:00 GMT");r.onreadystatechange=function(){r.readyState<4||(r.status==200?i(!0,r.responseText,r):i(!1,r))};r.send(t)}window.mst||(window.mst={});mst.setting_data={ap:{pass:""},wifi:[{ssid:"",pass:""}],status_pin:13,keyboard_language:0,keyboard_type:mst.key_pattern_default,keyboard_pin:{row:[],col:[],direct:[15]},default_layer:0,layers:{layer_0:{name:"レイヤー0",keys:{key_0:{press:{action_type:1,key:[4]},long_press:{},long_press_time:0}}}},option_set:{type:""}};mst.firmware_version="none";mst.edit_layer=0;mst.select_exec_cbfunc=null;mst.wifi_edit_kid=-1;mst.wifi_edit_data=null;mst.key_edit_kid=-1;mst.key_edit_data=null;mst.option_edit_data=null;mst.firmware_file_data=null;mst.switch_check_mode=0;mst.end_flag=!1;mst.end_type=0;mst.delete_file_list=[];mst.init=function(){mst.is_mobile()&&mst.body_rotate();mst.browser_btn_control();set_html("info_box","読み込み中..");mst.view_box(["info_box"]);ajax("/firmware_version","text",function(n,t){if(n&&t){var i=JSON.parse(t);mst.firmware_version=i.v;mst.esp_type=parseInt(i.t)}mst.get_setting_json()})};mst.popstate_func=function(){history.pushState(null,null,location.href)};mst.popstate_func_ov=function(){updateBreadCrumbObservable()};mst.beforeunload_func=function(n){return n.preventDefault(),"別のページへ移動しますか？"};mst.browser_btn_control=function(){history.pushState(null,null,location.href);window.addEventListener("popstate",mst.popstate_func,!1);window.addEventListener("popstate",mst.popstate_func_ov,!1);window.addEventListener("beforeunload",mst.beforeunload_func,!1)};mst.browser_btn_control_remove=function(){window.removeEventListener("popstate",mst.popstate_func,!1);window.removeEventListener("popstate",mst.popstate_func_ov,!1);window.removeEventListener("beforeunload",mst.beforeunload_func,!1)};mst.get_setting_json=function(){ajax("/get_setting_json","text",function(n,t){if(!n){set_html("info_box","キー設定 読み込み 失敗: /get_setting_json");mst.key_pattern=mst.key_pattern_list[mst.key_pattern_default];set_html("top_title",mst.key_pattern.name);mst.view_layer();return}if(mst.setting_data=JSON.parse(t),set_html("info_box","キー設定 読み込み 完了 "),mst.setting_data.option_set||(mst.setting_data.option_set={type:""}),mst.key_pattern=mst.key_pattern_list[mst.setting_data.keyboard_type]?mst.key_pattern_list[mst.setting_data.keyboard_type]:mst.key_pattern_list[mst.key_pattern_default],mst.setting_data.option_set.type&&mst.option_list[mst.setting_data.option_set.type]){var u=mst.option_list[mst.setting_data.option_set.type],i=["pin","size","keys","parts"];for(var r in i)u[i[r]]&&(mst.key_pattern[i[r]]=u[i[r]])}set_html("top_title",mst.key_pattern.name);mst.edit_layer=mst.setting_data.default_layer;mst.view_layer()})};mst.save_setting_json=function(){var n=mst.key_pattern_list[mst.setting_data.keyboard_type];mst.setting_data.keyboard_pin=n.pin;mst.setting_data.status_pin=n.status_pin;mst.setting_data.rgb_pin=n.rgb_pin;mst.setting_data.rgb_len=n.rgb_len;mst.setting_data.led_num=n.led_num;mst.setting_data.key_matrix=n.key_matrix;mst.setting_data.option_set.type&&mst.option_list[mst.setting_data.option_set.type]&&mst.option_list[mst.setting_data.option_set.type].pin&&(mst.setting_data.keyboard_pin=mst.option_list[mst.setting_data.option_set.type].pin);mst.delete_ankey_file(function(){api_path="/upload_setting_json";mst.end_type==2&&(api_path="/upload_setting_json_reload");ajax_post(api_path,JSON.stringify(mst.setting_data),function(n){if(!n){set_html("info_box","ページを閉じて下さい");mst.view_box(["info_box"]);return}set_html("info_box","終了中..")})})};mst.file_send=function(n,t,i,r){var e=new FormData,u,f;e.append("file",i,t);u=new XMLHttpRequest;u.open("POST",n,!0);u.upload.addEventListener("progress",function(n){n.lengthComputable&&console.log("progress: "+n.loaded+" / "+n.total)});f=function(){r(!1,null)};u.addEventListener("error",f);u.upload.addEventListener("abort",f);u.upload.addEventListener("error",f);u.upload.addEventListener("timeout",f);u.onreadystatechange=function(){this.readyState==4&&(this.status==200?r(!0,this):r(!1,null))};u.send(e)};mst.file_delete=function(n,t){ajax("delete_file_"+n,"text",t)};mst.file_delete_list=function(n,t){if(n&&(mst.delete_file_list=n),console.log(mst.delete_file_list.length),!mst.delete_file_list.length){t();return}var i=mst.delete_file_list.pop();ajax("delete_file_"+i,"text",function(){mst.file_delete_list(null,t)})};mst.is_mobile=function(){return!1};mst.body_rotate=function(){var n=$("body_box"),i=n.offsetHeight,r=n.offsetWidth,t="rotate(90deg)";n.style.transformOrigin="0 0 0";n.style.transform=t;n.style.MozTransform=t;n.style.msTransform=t;n.style.OTransform=t;n.style.top=0;n.style.left=window.innerWidth+"px";n.style.width=window.innerHeight-50+"px"};mst.view_box=function(n){var t=["info_box","select_box","setting_box","layer_box","layer_menu","key_img_box","top_menu_box","menu_box"];for(var i in t)n.indexOf(t[i])>=0?show(t[i]):hide(t[i]);window.scrollTo(0,0)};mst.get_key_char=function(n,t){var i;t||(t="char");for(i in mst.key_list)if(parseInt(mst.key_list[i].key)==n)return mst.key_list[i][t];return""};mst.view_layer=function(){var n="";n+=""+mst.get_layer_name(mst.edit_layer)+"　";n+="<div style='display: inline-block;'>";n+="<div id='layer_menu'>";n+="<a href='#' class='update_button' onClick='javascript:mst.select_layer(); return false;'>▼<\/a>　";mst.edit_layer>0&&(n+="<a href='#' class='update_button' onClick='javascript:mst.delete_layer(); return false;'>×<\/a>　");n+="<a href='#' class='update_button' onClick='javascript:mst.add_layer(); return false;'>＋<\/a>　";n+="<\/div>";n+="<\/div>";set_html("layer_box",n);mst.create_key_image();mst.create_key_btn();mst.view_box(["layer_box","layer_menu","key_img_box","menu_box","top_menu_box","info_box"])};mst.select_layer=function(){var n=mst.get_layer_list();mst.select_exec(n,mst.edit_layer+"",function(n){mst.edit_layer=parseInt(n);mst.view_layer()})};mst.add_layer=function(){var i,t,n=0;for(i in mst.setting_data.layers)t=parseInt(i.substring(6)),t>n&&(n=t);n++;mst.setting_data.layers["layer_"+n]={name:"レイヤー"+n,keys:{}};mst.edit_layer=n;mst.view_layer()};mst.delete_layer=function(){mst.edit_layer>0&&(delete mst.setting_data.layers["layer_"+mst.edit_layer],mst.edit_layer=0);mst.view_layer()};mst.create_key_btn=function(){var r,s,i,e,u,t,o,n,f,h;t="";for(i in mst.key_pattern.keys){if(u=mst.key_pattern.keys[i],n=mst.get_key_setting_num(u.id),f="position: absolute;",f+="margin: -2px; border: 3px solid black; border-radius: 12px;overflow: hidden;",f+=mst.switch_check_mode?"background-color: rgba(80,80, 80, 0.8);":n.press.action_type==0?"background-color: rgb(255, 73, 73);":"background-color: rgb(129, 255, 129);",f+="top: "+u.y+"px; left: "+u.x+"px;",f+="width: "+u.width+"px; height: "+u.height+"px;",t+="<div id='key_"+i+"' style='"+f+"' onClick='javascript: mst.key_click("+i+");'>",h=u.width<100?.7:1,t+="<table style='width: "+(u.width+20)+"px; height: "+(u.height+20)+"px;scale:"+h+";margin: -10px;'><tr><td align='center'>",mst.switch_check_mode)t+="<div id='key_top_"+i+"' style='color: white; font-size: 50px;'>"+u.id+"<\/div>";else if(n.press.action_type==0)t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;line-height: 27px;'>None<\/div>";else if(n.press.action_type==1)if(n.press.key.length<=1)r=mst.get_key_char(n.press.key[0]),s=r.length>3?"30px":"43px",t+="<div id='key_top_"+i+"' style='color: black; font-size: "+s+";'>"+r+"<\/div>";else{t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;line-height: 27px;'>";o=[];for(e in n.press.key)o.push(mst.get_key_char(n.press.key[e])),console.log(e+" : "+n.press.key[e]+" : "+mst.get_key_char(n.press.key[e]));console.log(o);t+=o.join(" + ");t+="<\/div>"}else n.press.action_type==2?t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;'>text<\/div>":n.press.action_type==3?t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;'>"+mst.get_layer_name(n.press.layer)+"<\/div>":n.press.action_type==4?t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;'>WEB<\/div>":n.press.action_type==5?t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;'>MUS<\/div>":n.press.action_type==6?t+="<div id='key_top_"+i+"' style='color: black; font-size: 27px;'>暗<\/div>":n.press.action_type==7?(n.press.led_setting_type==0&&(r="ONOF"),n.press.led_setting_type==1&&(r="UP"),n.press.led_setting_type==2&&(r="DOWN"),n.press.led_setting_type==3&&(r="CRCH"),n.press.led_setting_type==4&&(r="TYCH"),t+="<div id='key_top_"+i+"' style='color: black; font-size: 23px;'>LED<br>"+r+"<\/div>"):n.press.action_type==8&&(n.press.dakagi_settype==0&&(r="HM"),n.press.dakagi_settype==1&&(r="QR"),n.press.dakagi_settype==2&&(r="ATS"),n.press.dakagi_settype==3&&(r="SAVE"),t+="<div id='key_top_"+i+"' style='color: black; font-size: 23px;'>鍵<br>"+r+"<\/div>");t+="<\/td><\/tr><\/table>";t+="<\/div>"}set_html("key_objs_box",t)};mst.create_key_image=function(){var r,i,n,t;$("key_box").style.width=mst.key_pattern.size.width+"px";$("key_box").style.height=mst.key_pattern.size.height+"px";$("key_img_box").style.width=mst.key_pattern.size.width+"px";$("key_img_box").style.height=mst.key_pattern.size.height+"px";$("key_img").width=mst.key_pattern.size.width;$("key_img").height=mst.key_pattern.size.height;t=$("key_img").getContext("2d");for(r in mst.key_pattern.parts)if(n=mst.key_pattern.parts[r],n.type=="polygon"){n.line_width&&(t.lineWidth=n.line_width);n.line_color&&(t.strokeStyle=n.line_color);n.fill_color&&(t.fillStyle=n.fill_color);t.beginPath();for(i in n.path)console.log(n.path[i]),i==0?t.moveTo(n.path[i][0],n.path[i][1]):t.lineTo(n.path[i][0],n.path[i][1]);t.closePath();n.fill?t.fill():t.stroke()}};mst.key_click=function(n){if(!mst.switch_check_mode){var t=mst.key_pattern.keys[n].id;mst.view_key_setting(t);set_html("info_box","")}};mst.get_key_setting_num=function(n){return mst.setting_data.layers["layer_"+mst.edit_layer].keys["key_"+n]||(mst.setting_data.layers["layer_"+mst.edit_layer].keys["key_"+n]={press:{action_type:0},long_press:{},long_press_time:0}),mst.setting_data.layers["layer_"+mst.edit_layer].keys["key_"+n]};mst.select_on_click=function(n){mst.select_exec_cbfunc(n);set_html("select_box","");hide("select_box");mst.select_exec_cbfunc=null};mst.select_exec=function(n,t,i){var r,u,e,o=-1,s,f;mst.select_exec_cbfunc=i;f=""+("<div id='lists' class='lists' style='width: "+(window.innerWidth-100)+"px;'>");for(r in n)u=n[r],u.key==t?(e="background-color: #34F464;",o=r):e="",f+="<div id='opt_"+r+"' style='border-bottom: solid 1px #888;margin: 0; padding: 17px; font-size: 50px;display: block;"+e+"' onClick='javascript:mst.select_on_click(\""+u.key+"\")'>"+u.value+"<\/div>";f+="<\/div>";set_html("select_box",f);mst.view_box(["select_box"]);o>=0&&(s=$("opt_"+o).getBoundingClientRect(),window.scrollTo(0,s.top-100))};mst.get_layer_list=function(){var n,t,i=[];for(n in mst.setting_data.layers)t=n.substring(6),i.push({key:t,value:mst.setting_data.layers[n].name});return i};mst.get_layer_name=function(n){return mst.setting_data.layers["layer_"+n]?mst.setting_data.layers["layer_"+n].name:""};mst.select_input_type=function(){var n,t=[];for(n in mst.input_type_list)(n!=6||mst.esp_type!=0)&&(n==7&&mst.setting_data.rgb_pin<0||(n!=8||mst.setting_data.option_set.type=="display_66jp")&&t.push({key:n,value:mst.input_type_list[n]}));mst.select_exec(t,mst.key_edit_data.press.action_type+"",function(n){mst.key_edit_data.press.action_type=parseInt(n);mst.key_edit_data.press.action_type==1?"key"in mst.key_edit_data.press||(mst.key_edit_data.press.key=[4],mst.key_edit_data.press.repeat_interval=51):mst.key_edit_data.press.action_type==2?"text"in mst.key_edit_data.press||(mst.key_edit_data.press.text=""):mst.key_edit_data.press.action_type==3?"layer"in mst.key_edit_data.press||(mst.key_edit_data.press.layer=0):mst.key_edit_data.press.action_type==4?"webhook"in mst.key_edit_data.press||(mst.key_edit_data.press.webhook={url:"http://palette-system.com/ct/",header:[],post:"",keyoutput:0}):mst.key_edit_data.press.action_type==5?"move"in mst.key_edit_data.press||(mst.key_edit_data.press.move={x:0,y:0,speed:100}):mst.key_edit_data.press.action_type==6?"ankey_file"in mst.key_edit_data.press||(mst.key_edit_data.press.ankey_file="A"+Math.random().toString(36).slice(-8)):mst.key_edit_data.press.action_type==7?"led_setting_type"in mst.key_edit_data.press||(mst.key_edit_data.press.led_setting_type=0):mst.key_edit_data.press.action_type==8&&("dakagi_settype"in mst.key_edit_data.press||(mst.key_edit_data.press.dakagi_settype=0));mst.view_key_setting(mst.key_edit_kid)})};mst.select_input_key=function(n){mst.select_exec(mst.key_list,mst.key_edit_data.press.key[n]+"",function(t){mst.key_edit_data.press.key[n]=parseInt(t);mst.view_key_setting(mst.key_edit_kid)})};mst.select_change_layer=function(){mst.select_exec(mst.get_layer_list(),mst.key_edit_data.press.layer+"",function(n){mst.key_edit_data.press.layer=parseInt(n);mst.view_key_setting(mst.key_edit_kid)})};mst.check_ascii=function(n){var t=n.value;for(i=0;i<t.length;i++)if(escape(t.charAt(i)).length>=4)return alert("半角英数字を入力してください。"),n.value="",!1;return!0};mst.text_on_change=function(){var n=$("key_text");mst.check_ascii(n);mst.key_edit_data.press.text=n.value};mst.web_hook_url_check=function(n){return n.length?n.slice(0,7)!="http://"&&n.slice(0,8)!="https://"?(alert("http:// か https:// のみ指定できます"),!1):!0:!0};mst.url_on_change=function(){var n=$("url_text"),t=n.value;if(!mst.web_hook_url_check(t)){n.value=mst.key_edit_data.press.webhook.url;return}mst.key_edit_data.press.webhook.url=t};mst.is_https_url=function(n){return n.length<8?!1:n.slice(0,8)=="https://"?!0:!1};mst.view_key_setting=function(n){mst.key_edit_kid<0&&(mst.key_edit_kid=n,mst.key_edit_data=obj_clone(mst.get_key_setting_num(mst.key_edit_kid)));var i=mst.key_edit_data.press,r=i.action_type,s,u,o,t="",e,f="border: 1px solid #9a9fe3;";if(t+="<table cellpadding='20' style='min-width: 520px;'>",t+="<tr><td colspan='2'><b>キー番号：<\/b> <font style='font-size: 40px;'>"+mst.key_edit_kid+"<\/font><\/td><\/tr>",t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",t+="<tr><td><b>動作：<\/b><br><font style='font-size: 40px;'>"+mst.input_type_list[r]+"<\/font><\/td><td align='right'>",t+="<a href='#' class='update_button' onClick='javascript:mst.select_input_type(); return false;'>変更<\/a>",t+="<\/td><\/tr>",r==1){for(u in i.key)o=mst.get_key_char(i.key[u],"value"),s=o.length<12?40:30,t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",t+="<tr><td>",t+="<b>キー "+(parseInt(u)+1)+"：<\/b> <font style='font-size: "+s+"px;'>"+o+"<\/font>　",t+="<\/td><td align='right'>",t+="<a href='#' class='update_button' onClick='javascript:mst.select_input_key("+u+"); return false;'>変更<\/a>",i.key.length>1&&(t+=" <a href='#' class='update_button' onClick='javascript:mst.delete_input_key("+u+"); return false;'>×<\/a>"),t+="<\/td><\/tr>";i.key.length<5&&(t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",t+="<tr><td colspan='2' align='right'>",t+="<br><a href='#' class='update_button' onClick='javascript:mst.add_input_key(); return false;'>入力キー追加<\/a>",t+="<\/td><\/tr>");i.repeat_interval===undefined&&(i.repeat_interval=51);console.log(i);t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>";t+="<tr><td colspan='2'>";t+="<b>連打間隔：<\/b>　<font id='move_repeat_interval_val'><\/font><br><br>";t+="<center><input type='range' id='move_repeat_interval' name='move_repeat_interval' min='0' max='51' style='width: 420px;' value='"+i.repeat_interval+"' onChange='javascript:mst.view_move_input(\"repeat_interval\");'><\/center>";t+="<\/td><\/tr>"}else if(r==2)t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",e="font-size: 30px; width: 520px; border: 3px solid black;",t+="<tr><td colspan='2'>",t+="<b>テキスト：<\/b><br><input type='text' id='key_text' style='"+e+"' value='' onChange='javascript:mst.text_on_change();'>",t+="<\/td><\/tr>";else if(r==3)t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",t+="<tr><td>",t+="<b>レイヤー：<\/b><br><font style='font-size: 40px;'>"+mst.get_layer_name(i.layer)+"<\/font><\/td><td align='right'>",t+="<a href='#' class='update_button' onClick='javascript:mst.select_change_layer(); return false;'>変更<\/a>",t+="<\/td><\/tr>",t+="<tr><td colspan='2'>",t+="<br><br><font style='font-size: 30px;'>※ このキーを押している間、指定したレイヤーの動作に切り替わります。<\/font><br><br>",t+="<\/td><\/tr>";else if(r==4){t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>";e="font-size: 30px; width: 520px; border: 3px solid black;";t+="<tr><td colspan='2'>";t+="<b>URL ：<\/b><br><input type='text' id='url_text' style='"+e+"' value='' onChange='javascript:mst.url_on_change();'>";t+="<br><br>";t+="<b>HTTPヘッダー ：<\/b><br>";for(u in i.webhook.header)t+="<p style='font-size: 24px; margin: 0; padding: 0; overflow: hidden; width: 520px;'>　"+i.webhook.header[u].key+" : "+i.webhook.header[u].value+"<\/p><br>",t+="<p style='text-align: right; margin: 0; padding: 6px;'><a href='#' class='update_button' onClick='javascript:mst.view_webhook_header_edit("+u+");return false;'>編集<\/a>　",t+="<a href='#' class='update_button' onClick='javascript:mst.delete_webfook_header("+u+");return false;'>削除<\/a><\/p>";t+="<p style='text-align: right; margin: 0; padding: 30px 6px;'><a href='#' class='update_button' onClick='javascript:mst.add_webfook_header();return false;'>HTTPヘッダー追加<\/a><\/p>";t+="<b>POSTデータ ：<\/b><br>";t+="<textarea id='webhook_post_text' style='font-size: 30px; width: 520px; height: 200px; border: 3px solid black;'><\/textarea>";t+="<br><br>";t+="<b>キー動作 ：<\/b><br>";t+="<select id='webhook_keyoutput' style='font-size: 30px; border: 3px solid black;'>";t+="<option value='0'>無し<\/option>";t+="<option value='1'>ステータスコードを入力<\/option>";t+="<option value='2'>HTTPレスポンスを入力<\/option>";t+="<\/select>";t+="<\/td><\/tr>";mst.setting_data.wifi.length||(t+="<tr><td colspan='2'>",t+="<font style='font-size: 30px;'>※ 有効にするにはWIFIの設定が必要です。<\/font><br>",t+="<\/td><\/tr>")}else r==5?(t+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+f+"'><\/td><\/tr>",t+="<tr><td colspan='2'>",t+="<b>Ｘ：<\/b><font id='move_x_val'>"+i.move.x+"<\/font><br><input type='range' id='move_x' name='move_x' min='-100' max='100' style='width: 400px;' value='"+i.move.x+"' onChange='javascript:mst.view_move_input(\"x\");'><br><br>",t+="<b>Ｙ：<\/b><font id='move_y_val'>"+i.move.y+"<\/font><br><input type='range' id='move_y' name='move_y' min='-100' max='100' style='width: 400px;' value='"+i.move.y+"' onChange='javascript:mst.view_move_input(\"y\");'><br><br>",t+="<b>スピード：<\/b><font id='move_speed_val'>"+i.move.speed+"<\/font><br><input type='range' id='move_speed' name='move_speed' min='0' max='100' style='width: 400px;' value='"+i.move.speed+"' onChange='javascript:mst.view_move_input(\"speed\");'><br><br>",t+="<\/td><\/tr>"):r==6||(r==7?(t+="<tr><td colspan='2'>",t+="<b>設定の種類 ：<\/b><br>",t+="<select id='led_setting_type' style='font-size: 30px; border: 3px solid black; width: 350px;'>",t+="<option value='0'>ON / OFF<\/option>",t+="<option value='1'>明るさUP<\/option>",t+="<option value='2'>明るさDOWN<\/option>",t+="<option value='3'>色変更<\/option>",t+="<option value='4'>光らせ方変更<\/option>",t+="<\/select>",t+="<\/td><\/tr>"):r==8&&(t+="<tr><td colspan='2'>",t+="<b>設定の種類 ：<\/b><br>",t+="<select id='dakagi_settype' style='font-size: 30px; border: 3px solid black; width: 350px;'>",t+="<option value='0'>ヒートマップ表示<\/option>",t+="<option value='1'>QRコード<\/option>",t+="<option value='2'>自動保存設定<\/option>",t+="<option value='3'>打鍵数保存<\/option>",t+="<\/select>",t+="<\/td><\/tr>"));t+="<\/table>";t+="<br><br>";t+="<center>";t+="<a href='#' class='button' onClick='javascript:mst.key_setting_btn_click(1);return false;'>決定<\/a>　　";t+="<a href='#' class='button' onClick='javascript:mst.key_setting_btn_click(0);return false;'>キャンセル<\/a>";t+="<\/center>";t+="<br><br>";set_html("setting_box",t);r==1?mst.view_move_input("repeat_interval"):r==2?$("key_text").value=i.text:r==4?($("url_text").value=i.webhook.url,$("webhook_post_text").value=i.webhook.post,$("webhook_keyoutput").value=i.webhook.keyoutput+""):r==7?$("led_setting_type").value=i.led_setting_type+"":r==8&&($("dakagi_settype").value=i.dakagi_settype+"");mst.view_box(["info_box","setting_box","layer_box"])};mst.view_move_input=function(n){var t=$("move_"+n).value;n=="repeat_interval"&&t>50&&(t="連打無し");set_html("move_"+n+"_val",t)};mst.delete_webfook_header=function(n){var t,i=[];for(t in mst.key_edit_data.press.webhook.header)t!=n&&i.push(mst.key_edit_data.press.webhook.header[t]);mst.key_edit_data.press.webhook.header=i;mst.view_key_setting(mst.key_edit_kid)};mst.add_webfook_header=function(){mst.key_edit_data.press.webhook.header.push({key:"",value:""});mst.view_webhook_header_edit(mst.key_edit_data.press.webhook.header.length-1)};mst.view_webhook_header_edit=function(n){var t="",i,r=mst.key_edit_data.press.webhook.header[n];mst.key_edit_data.press.webhook.url=$("url_text").value;mst.key_edit_data.press.webhook.post=$("webhook_post_text").value;mst.key_edit_data.press.webhook.keyoutput=parseInt($("webhook_keyoutput").value);i="font-size: 30px; width: 520px; border: 3px solid black;";t+="<b style='font-size: 30px;'>HTTPヘッダー<\/b><br><br><br>";t+="<b>Key ：<\/b><br><input type='text' id='webheader_key' style='"+i+"' value=''>";t+="<br><br>";t+="<b>Value ：<\/b><br><input type='text' id='webheader_value' style='"+i+"' value=''>";t+="<br><br><br><br>";t+="<center>";t+="<a href='#' class='button' onClick='javascript:mst.webhook_header_end_btn("+n+", 1);return false;'>決定<\/a>　　";t+="<a href='#' class='button' onClick='javascript:mst.webhook_header_end_btn("+n+", 0);return false;'>キャンセル<\/a>";t+="<\/center>";t+="<br><br>";set_html("setting_box",t);mst.view_box(["info_box","setting_box","layer_box"]);$("webheader_key").value=r.key;$("webheader_value").value=r.value};mst.webhook_header_end_btn=function(n,t){t&&(mst.key_edit_data.press.webhook.header[n].key=$("webheader_key").value,mst.key_edit_data.press.webhook.header[n].value=$("webheader_value").value);mst.view_key_setting(mst.key_edit_kid)};mst.delete_input_key=function(n){var t,i=[];for(t in mst.key_edit_data.press.key)t!=n&&i.push(mst.key_edit_data.press.key[t]);mst.key_edit_data.press.key=i;mst.view_key_setting(mst.key_edit_kid)};mst.add_input_key=function(){mst.key_edit_data.press.key.push(4);mst.select_input_key(mst.key_edit_data.press.key.length-1)};mst.key_setting_btn_click=function(n){var t;n==1&&(t={action_type:mst.key_edit_data.press.action_type},t.action_type==1?(t.key=mst.key_edit_data.press.key,t.repeat_interval=$("move_repeat_interval").value):t.action_type==2?t.text=mst.key_edit_data.press.text:t.action_type==3?t.layer=mst.key_edit_data.press.layer:t.action_type==4?(mst.key_edit_data.press.webhook.url=$("url_text").value,mst.key_edit_data.press.webhook.post=$("webhook_post_text").value,mst.key_edit_data.press.webhook.keyoutput=parseInt($("webhook_keyoutput").value),t.webhook=mst.key_edit_data.press.webhook):t.action_type==5?t.move={x:$("move_x").value,y:$("move_y").value,speed:$("move_speed").value}:t.action_type==6?t.ankey_file=mst.key_edit_data.press.ankey_file:t.action_type==7?t.led_setting_type=parseInt($("led_setting_type").value):t.action_type==8&&(t.dakagi_settype=parseInt($("dakagi_settype").value)),mst.setting_data.layers["layer_"+mst.edit_layer].keys["key_"+mst.key_edit_kid].press=t);mst.key_edit_kid=-1;mst.key_edit_data=null;mst.create_key_btn();set_html("info_box","");mst.view_box(["info_box","layer_box","layer_menu","key_img_box","top_menu_box","menu_box"])};mst.check_ankey_file=function(n){var i,r,t;for(i in mst.setting_data.layers){layer_data=mst.setting_data.layers[i];for(r in layer_data.keys)if((key_data=layer_data.keys[r],t=key_data.press,t.action_type==6)&&t.ankey_file&&t.ankey_file==n)return!0}return!1};mst.delete_ankey_file=function(n){ajax("/file_list","text",function(t,i){if(!t||!i){n(!1);return}var r,u=JSON.parse(i),f=[];for(r in u.data)(file_path=u.data[r],file_path.substr(0,2)=="/A")&&(file_name=file_path.substr(1),mst.check_ankey_file(file_name)||f.push(file_name));mst.file_delete_list(f,n)})};mst.end_setting=function(n){mst.end_flag=!0;mst.end_type=n;mst.browser_btn_control_remove();mst.end_type==1||mst.end_type==2?(set_html("info_box","保存中.. "),mst.view_box(["info_box"]),mst.save_setting_json()):(set_html("info_box","終了中.. "),ajax("/end_setting","text",function(){set_html("info_box","ページを閉じて下さい");mst.view_box(["info_box"])}),mst.view_box(["info_box"]),setTimeout(function(){window.open("about:blank","_self").close()},1500))};mst.view_wifi_setting=function(){var t,n="",i="border: 1px solid #9a9fe3; margin: 40px 0;";n+="<b style='font-size: 30px;'>WIFI設定<\/b>";n+="<table style='min-width: 520px;'>";for(t in mst.setting_data.wifi)n+="<tr><td colspan='2' style='padding: 12px 0;'><hr style='"+i+"'><\/td><\/tr>",n+="<tr><td><b style='font-size: 27px;'>"+mst.setting_data.wifi[t].ssid+"<\/b><\/td><td align='right'>",n+="<a href='#' class='button' onClick='javascript:mst.wifi_edit_btn("+t+");return false;'>編集<\/a>　",n+="<a href='#' class='button' onClick='javascript:mst.wifi_delete_btn("+t+");return false;'>削除<\/a>",n+="<\/td><\/tr>";n+="<tr><td colspan='2' style='padding: 20px 0;'><hr style='"+i+"'><\/td><\/tr>";n+="<tr><td colspan='2' style='padding: 20px 0;' align='right'>";n+="<a href='#' class='button' onClick='javascript:mst.wifi_edit_btn(-1);return false;'>WIFI追加<\/a>";n+="<\/td><\/tr><\/table>";n+="<br><br><br>";n+="<center>";n+="<a href='#' class='button' onClick='javascript:mst.view_detail_setting();return false;'>完了<\/a>";n+="<\/center>";set_html("setting_box",n);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.wifi_edit_btn=function(n){n<0&&(n=mst.setting_data.wifi.length,mst.setting_data.wifi.push({new_flag:!0,ssid:"",pass:""}));mst.wifi_edit_kid=n;mst.wifi_edit_data=obj_clone(mst.setting_data.wifi[n]);mst.view_wifi_setting_one(mst.wifi_edit_data)};mst.wifi_delete_btn=function(n){mst.setting_data.wifi.splice(n,1);mst.view_wifi_setting()};mst.view_wifi_setting_one=function(n){var t="";t+="<b style='font-size: 30px;'>WIFI設定<\/b><br><br><br>";t+="<b>ssid ： <\/b><br>";t+="<input type='text' id='wifi_ssid_text' style='font-size: 35px; border: 3px solid black; width: 380px;' value=''> ";t+="<a href='#' class='update_button' onClick='javascript:mst.wifi_search(); return false;'>▼<\/a>";t+="<br><br><br>";t+="<b>pass ： <\/b><br>";t+="<input type='password' id='wifi_pass_text' style='font-size: 35px; border: 3px solid black; width: 380px;' value=''>";t+="<br><br><br><br><br>";t+="<center><div id='wifi_setting_btn_box'>";t+="<a href='#' class='button' onClick='javascript:mst.wifi_setting_btn_click(1);return false;'>決定<\/a>　　";t+="<a href='#' class='button' onClick='javascript:mst.wifi_setting_btn_click(0);return false;'>キャンセル<\/a>";t+="<\/div><\/center>";set_html("setting_box",t);$("wifi_ssid_text").value=n.ssid;$("wifi_pass_text").value=n.pass;set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.wifi_search=function(){mst.view_box(["info_box"]);set_html("info_box","アクセスポイント 検索中 ...");ajax("/get_ap_list","text",function(n,t){var r,f,u;if(!n){mst.view_wifi_setting_one(mst.wifi_edit_data);set_html("info_box","アクセスポイント検索 失敗");return}if(r=JSON.parse(t),!r.list,!r.list.length){mst.view_wifi_setting_one(mst.wifi_edit_data);set_html("info_box","アクセスポイント検索 失敗");return}set_html("info_box","");u=[];for(i in r.list)f=r.list[i].auth_open?"(open)":"",u.push({key:r.list[i].ssid,value:r.list[i].ssid+" "+f});mst.select_exec(u,mst.wifi_edit_data.ssid,function(n){mst.wifi_edit_data.ssid=n;mst.view_wifi_setting_one(mst.wifi_edit_data)})})};mst.wifi_conn_check=function(){var n=$("wifi_ssid_text").value,t=$("wifi_pass_text").value;if(!n.length){set_html("wifi_conn_check_info_box","ssidを指定してください");return}set_html("wifi_conn_check_info_box","接続中...");hide("wifi_setting_btn_box");ajax_post("/wifi_conn_check",n+"\n"+t,function(n,t){if(!n){set_html("wifi_conn_check_info_box","<font style='color: #FF9999;'><b>エラー<\/b><\/font>");show("wifi_setting_btn_box");return}t=="OK"?set_html("wifi_conn_check_info_box","<font style='color: #00FF99;'><b>OK<\/b><\/font>"):set_html("wifi_conn_check_info_box","<font style='color: #FF9999;'><b>NG<\/b><\/font>");show("wifi_setting_btn_box")})};mst.wifi_setting_btn_click=function(n){var t;n?(t=mst.wifi_edit_kid,mst.setting_data.wifi[t].ssid=$("wifi_ssid_text").value,mst.setting_data.wifi[t].pass=$("wifi_pass_text").value,"new_flag"in mst.setting_data.wifi[t]&&delete mst.setting_data.wifi[t].new_flag):mst.wifi_edit_data.new_flag&&mst.setting_data.wifi.splice(mst.wifi_edit_kid,1);mst.wifi_edit_kid=-1;mst.wifi_edit_data=null;mst.view_wifi_setting()};mst.view_language_setting=function(n){var t="";t+="<b style='font-size: 30px;'>日本語/US 切り替え<\/b><br><br><br><br>";n||(n=mst.setting_data.keyboard_language);t+="　　<b style='font-size: 32px;'>"+mst.key_language_list[n]+"<\/b>";t+="<div style='text-align: right;padding: 0 50px;'><a href='#' class='update_button' onClick='javascript:mst.keylanguage_select(\""+n+"\"); return false;'>変更<\/a><\/div>";t+="<br><br><br><br><br><br>";t+="<center><div id='wifi_setting_btn_box'>";t+="<a href='#' class='button' onClick='javascript:mst.keylanguage_setting_btn_click(1, \""+n+"\");return false;'>決定<\/a>　　";t+="<a href='#' class='button' onClick='javascript:mst.keylanguage_setting_btn_click(0, \""+n+"\");return false;'>キャンセル<\/a>";t+="<\/div><\/center>";set_html("setting_box",t);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.keylanguage_select=function(n){var t,i=[];for(t in mst.key_language_list)i.push({key:t,value:mst.key_language_list[t]});mst.select_exec(i,n,function(n){mst.view_language_setting(n)})};mst.keylanguage_setting_btn_click=function(n,t){if(!n||mst.setting_data.keyboard_language==t){mst.view_detail_setting();return}mst.setting_data.keyboard_language=t;mst.view_detail_setting()};mst.view_keytype_setting=function(n){var t="";t+="<b style='font-size: 30px;'>キーボードの種類設定<\/b><br><br><br><br>";n||(n=mst.setting_data.keyboard_type);t+="　　<b style='font-size: 32px;'>"+mst.key_pattern_list[n].name+"<\/b>";t+="<br><br><br><br><br><br>";mst.setting_data.keyboard_type!=n&&(t+="<div style='margin: 0 40px;'>※ キーボードがが変更されたので「決定」を押すと設定を保存して再起動します。<\/div>",t+="<br><br><br>");t+="<center><div id='wifi_setting_btn_box'>";t+="<a href='#' class='button' onClick='javascript:mst.keytype_setting_btn_click(1, \""+n+"\");return false;'>決定<\/a>　　";t+="<a href='#' class='button' onClick='javascript:mst.keytype_setting_btn_click(0, \""+n+"\");return false;'>キャンセル<\/a>";t+="<\/div><\/center>";set_html("setting_box",t);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.keytype_select=function(n){var t,i=[];for(t in mst.key_pattern_list)i.push({key:t,value:mst.key_pattern_list[t].name});mst.select_exec(i,n,function(n){mst.view_keytype_setting(n)})};mst.keytype_setting_btn_click=function(n,t){if(!n||mst.setting_data.keyboard_type==t){mst.view_detail_setting();return}mst.setting_data.keyboard_type=t;mst.setting_data.option_set={type:""};mst.end_setting(2)};mst.view_option_setting=function(n){var t="",i="border: 1px solid #9a9fe3; margin: 40px 0;",r,u;t+="<b style='font-size: 30px;'>ユニット設定<\/b><br><br><br><br>";n||(mst.option_edit_data=obj_clone(mst.setting_data.option_set));t+=mst.option_edit_data.type?"<b>ユニット ：<\/b>　　<b style='font-size: 32px;'>"+mst.option_list[mst.option_edit_data.type].name+"<\/b>":"<b>ユニット ：<\/b>　　<b style='font-size: 32px;'>なし<\/b>";t+="<div style='text-align: right;padding: 10px 50px;'><a href='#' id='unich_btn' class='update_button' onClick='javascript:mst.option_type_select(); return false;'>変更<\/a><\/div>";t+="<br>";t+="<table style='min-width: 520px;'>";mst.option_edit_data.type=="foot_m"?(r="しない",mst.option_edit_data.inversion=="1"&&(r="する"),t+="<tr><td colspan='2' style='padding: 12px 0;'><hr style='"+i+"'><\/td><\/tr>",t+="<tr><td><b>入力反転：<\/b>　　<b style='font-size: 27px;'>"+r+"<\/b><\/td><td align='right'>",t+="<a href='#' id='rvch_btn' class='update_button' onClick='javascript:mst.foot_inv_edit_btn();return false;'>変更<\/a>",t+="<\/td><\/tr>"):mst.option_edit_data.type=="trackball_m"?(t+="<tr><td colspan='2' style='padding: 12px 0;'><hr style='"+i+"'><\/td><\/tr>",t+="<tr><td colspan='2'><b>トラックボール向き：<\/b>　　<select id='trackball_direction' style='font-size: 30px; border: 3px solid black;'>",t+="<option value='0'>　上　<\/option>",t+="<option value='1'>　右　<\/option>",t+="<option value='2'>　下　<\/option>",t+="<option value='3'>　左　<\/option>",t+="<\/select>",t+="<\/td><\/tr>",t+="<tr><td colspan='2' style='padding: 40px 0;'> <\/td><\/tr>",t+="<tr><td colspan='2'><b>カーソル移動速度：<\/b>",t+="<center>",t+="<table style='width: 420px;'><tr><td align='left'>ゆっくり<\/td><td align='right'>早い<\/td><\/tr><\/table>",t+="<input type='range' id='trackball_speed' name='trackball_speed' min='4' max='80' style='width: 420px;' value='"+mst.option_edit_data.trackball_speed+"' onChange='javascript:mst.view_move_input(\"repeat_interval\");'>",t+="<\/center>",t+="<\/td><\/tr>"):mst.is_tft(mst.option_edit_data.type)&&(u="再生しない",mst.option_edit_data.op_movie=="1"&&(u="再生する"),t+="<tr><td colspan='2' style='padding: 12px 0;'><hr style='"+i+"'><\/td><\/tr>",t+="<tr><td><b>起動ムービー：<\/b>　　<b style='font-size: 27px;'>"+u+"<\/b><\/td><td align='right'>",t+="<a href='#' id='stmv_btn' class='update_button' onClick='javascript:mst.op_movie_edit_btn();return false;'>変更<\/a>",t+="<\/td><\/tr>",t+="<tr><td colspan='2' style='padding: 12px 0;'><hr style='"+i+"'><\/td><\/tr>",t+="<tr><td colspan='2'><b>待ち受け画像：<\/b><br>",t+="<input id='stimg_file' type='file' accept='image/*' onChange='javascript:mst.stimg_change(this);'><br>",t+="<canvas id='stimg_canvas' width='0' height='0'><\/canvas>",t+="<\/td><\/tr>",t+="<tr><td colspan='2' align='right'>",mst.option_edit_data.type==mst.setting_data.option_set.type&&(t+="<a href='#' id='stimg_ch' class='update_button' onClick='javascript:mst.stimg_check();return false;'>確認<\/a>　"),t+="<a href='#' id='stimg_del' class='update_button' onClick='javascript:mst.stimg_delete();return false;'>削除<\/a>",t+="<\/td><\/tr>");t+="<\/table>";t+="<br><br><br><br><br><br>";mst.option_edit_data.type!=mst.setting_data.option_set.type&&(t+="<div style='margin: 0 40px;'>※ ユニットが変更されたので「決定」を押すと設定を保存して再起動します。<\/div>",t+="<br><br><br>");t+="<div id='option_setting_info'><\/div>";t+="<center><div id='wifi_setting_btn_box'>";t+="<a href='#' id='uni_ok' class='button' onClick='javascript:mst.option_setting_btn_click(1);return false;'>決定<\/a>　　";t+="<a href='#' id='uni_can' class='button' onClick='javascript:mst.option_setting_btn_click(0);return false;'>キャンセル<\/a>";t+="<\/div><\/center>";set_html("setting_box",t);set_html("info_box","");mst.view_box(["info_box","setting_box"]);mst.option_edit_data.type=="trackball_m"?$("trackball_direction").value=mst.option_edit_data.trackball_direction+"":mst.is_tft(mst.option_edit_data.type)&&mst.view_imgdata("stimg_canvas","stimg.dat")};mst.view_imgdata=function(n,t){ajax("read_file_"+t,"arraybuffer",function(n,t){var i,s;if(n){console.log(t);i=new Uint8Array(t);console.log(i);var r=0,f,e,h,c,l,u=0,a=0,v=mst.get_tft_size(),y=v.width,p=v.height,o=$("stimg_canvas");for(o.width=y,o.height=p,s=o.getContext("2d");r<i.length;)f=i[r+1],e=i[r],h=e&248,c=((e&7)<<3|f>>5)<<2,l=(f&31)<<3,s.fillStyle="rgb("+h+","+c+","+l+")",s.fillRect(u,a,1,1),u++,u>=y&&(u=0,a++),r+=2}})};mst.option_type_select=function(){var n,t=[];t.push({key:"",value:"なし"});for(n in mst.option_list)mst.option_list[n].keyboard_type.indexOf(mst.setting_data.keyboard_type)>=0&&t.push({key:n,value:mst.option_list[n].name});select_type="";mst.option_edit_data.type&&(select_type=mst.option_edit_data.type);mst.select_exec(t,select_type,function(n){mst.option_edit_data.type=n;n=="foot_m"&&("inversion"in mst.option_edit_data||(mst.option_edit_data.inversion="0"));n=="trackball_m"&&("trackball_direction"in mst.option_edit_data||(mst.option_edit_data.trackball_direction="0"),"trackball_speed"in mst.option_edit_data||(mst.option_edit_data.trackball_speed="20"));mst.is_tft(n)&&("op_movie"in mst.option_edit_data||(mst.option_edit_data.op_movie="1"));mst.view_option_setting(1)})};mst.foot_inv_edit_btn=function(){mst.select_exec([{key:"0",value:"しない"},{key:"1",value:"する"}],mst.option_edit_data.inversion,function(n){mst.option_edit_data.inversion=n;mst.view_option_setting(1)})};mst.op_movie_edit_btn=function(){mst.select_exec([{key:"0",value:"再生しない"},{key:"1",value:"再生する"}],mst.option_edit_data.op_movie,function(n){mst.option_edit_data.op_movie=n;mst.view_option_setting(1)})};mst.is_tft=function(n){return n=="display_m"||n=="display_66jp"?!0:!1};mst.get_tft_size=function(){return mst.setting_data.option_set.type=="display_m"?{width:135,height:240}:mst.setting_data.option_set.type=="display_66jp"?{width:240,height:135}:{width:0,height:0}};mst.stimg_change=function(n){var i=n.files[0],t,r;(i.type=="image/jpeg"||i.type=="image/png"||i.type=="image/bmp")&&(t=new Image,r=new FileReader,r.onload=function(n){t.onload=function(){var d=mst.get_tft_size(),i=d.width,u=d.height,c,l,w,b,a,v,r,n,y,e,p,o,s,f,h,k;for(t.width/t.height>i/u?(a=t.height/t.width,c=i,l=i*a,w=0,b=(u-l)/2):(a=t.width/t.height,c=u*a,l=u,w=(i-c)/2,b=0),v=$("stimg_canvas"),v.width=i,v.height=u,r=v.getContext("2d"),r.rect(0,0,i,u),r.fillStyle="#000000",r.fill(),r.drawImage(t,0,0,t.width,t.height,w,b,c,l),imgdata=r.getImageData(0,0,i,u),console.log(imgdata.data.length),console.log(imgdata.data),n=0,f=[];n<imgdata.data.length;)y=imgdata.data[n]>>3,e=imgdata.data[n+1]>>2,p=imgdata.data[n+2]>>3,o=y<<3|e>>3,s=(e&7)<<5|p,f.push(o),f.push(s),n+=4;for(mst.option_edit_data.stimg_data=f,mst.option_edit_data.stimg_change=1,n=0,h=0,k=0;n<f.length;)s=f[n+1],o=f[n],y=o&248,e=((o&7)<<3|s>>5)<<2,p=(s&31)<<3,r.fillStyle="rgb("+y+","+e+","+p+")",r.fillRect(h,k,1,1),h++,h>=i&&(h=0,k++),n+=2};t.src=n.target.result},r.readAsDataURL(i))};mst.stimg_check=function(){var n=new Uint8Array(mst.option_edit_data.stimg_data),t=new Blob([n]);set_html("option_setting_info","画像を送信中です…");mst.file_send("/view_tft","stimg.dat",t,function(n){n||set_html("option_setting_info","画像の送信に失敗しました。");set_html("option_setting_info","")})};mst.stimg_delete=function(){var n=$("stimg_canvas");n.width=0;n.height=0;mst.option_edit_data.stimg_data=[];mst.option_edit_data.stimg_change=2};mst.option_setting_btn_click=function(n){var i,t,r,u;if(!n){mst.view_detail_setting();return}if(t=["unich_btn","rvch_btn","stmv_btn","stimg_file","uni_ok","uni_can","stimg_ch","stimg_del"],"stimg_change"in mst.option_edit_data){for(i in t)hide(t[i]);if(mst.option_edit_data.stimg_change==1){r=new Uint8Array(mst.option_edit_data.stimg_data);u=new Blob([r]);set_html("option_setting_info","画像を保存中です…");mst.file_send("/file_save","stimg.dat",u,function(n){if(!n){for(i in t)show(t[i],"inline-block");set_html("option_setting_info","画像を保存できませんでした");return}delete mst.option_edit_data.stimg_data;delete mst.option_edit_data.stimg_change;mst.option_setting_btn_click(1)});return}if(mst.option_edit_data.stimg_change==2){set_html("option_setting_info","画像を削除中です…");mst.file_delete("stimg.dat",function(n){if(!n){for(i in t)show(t[i],"inline-block");set_html("option_setting_info","画像を削除できませんでした");return}delete mst.option_edit_data.stimg_data;delete mst.option_edit_data.stimg_change;mst.option_setting_btn_click(1)});return}}if(mst.option_edit_data.type=="trackball_m"&&(mst.option_edit_data.trackball_direction=$("trackball_direction").value,mst.option_edit_data.trackball_speed=$("trackball_speed").value),mst.option_edit_data.type==mst.setting_data.option_set.type){mst.setting_data.option_set=mst.option_edit_data;mst.view_detail_setting();return}for(i in t)hide(t[i]);set_html("option_setting_info","本体を再起動中です…");mst.setting_data.option_set=mst.option_edit_data;mst.end_setting(2)};mst.view_detail_setting=function(){var n="",t="style='width: 450px;height: 70px; background: #78d3df; font-size: 35px; display: inline-block;'";n+="<b style='font-size: 30px;'>設定メニュー<\/b><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_language_setting();return false;'>日本語/US 切り替え<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_keytype_setting();return false;'>キーボードの種類<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_option_setting();return false;'>ユニット設定<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_switch_check();return false;'>スイッチ接触確認<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_wifi_setting();return false;'>WIFI設定<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_wifi_pass_setting();return false;'>ログイン設定<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.view_init_setting();return false;'>設定の初期化<\/a><br><br>";n+="<a href='#' class='update_button' "+t+" onClick='javascript:mst.firmware_setting();return false;'>ファームウェア<\/a><br><br>";n+="<br><br><br>";n+="<center>";n+="<a href='#' class='button' onClick='javascript:mst.view_layer();return false;'>完了<\/a>";n+="<\/center>";set_html("setting_box",n);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.view_switch_check=function(){mst.switch_check_mode=1;var n="";n+="<center>";n+="<a href='#' class='button' onClick='javascript:mst.switch_check_mode = 0; mst.view_detail_setting();return false;'>完了<\/a>";n+="<\/center>";set_html("info_box",n);mst.create_key_btn();mst.view_box(["info_box","key_img_box"]);mst.switch_check_loop()};mst.switch_check_loop=function(){ajax("/get_key_status","text",function(n,t){var i,r,u;if(n&&t.length)for(i in mst.key_pattern.keys)r=mst.key_pattern.keys[i],u=t.slice(parseInt(r.id),parseInt(r.id)+1),$("key_"+i).style.backgroundColor=u=="0"?"rgba(80, 80, 80, 0.8)":"rgba(100, 100, 233, 0.8)";mst.switch_check_mode&&setTimeout(mst.switch_check_loop,20)})};mst.view_wifi_pass_setting=function(){var n="";n+="<b style='font-size: 30px;'>ログイン設定<\/b><br><br>";n+="<font style='font-size: 32px;'>このページへアクセスするWIFIのパスワードを設定します。<\/font><br><br><br>";n+="<b>pass ： <\/b><br>";n+="<input type='password' id='ap_pass_text' style='font-size: 35px; border: 3px solid black;' value='"+mst.setting_data.ap.pass+"'>";n+="<br><br><br><br>";n+="<font style='font-size: 32px;'>※ 8文字以上で有効になります。<\/font><br>";n+="<br><br><br>";n+="<center>";n+="<div id='firmware_back_btn'>";n+="<a href='#' class='button' onClick='javascript:mst.wifi_pass_setting(1);return false;'>決定<\/a>　　　";n+="<a href='#' class='button' onClick='javascript:mst.wifi_pass_setting(0);return false;'>キャンセル<\/a>";n+="<\/div>";n+="<\/center>";set_html("setting_box",n);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.wifi_pass_setting=function(n){n&&(mst.setting_data.ap.pass=$("ap_pass_text").value);mst.view_detail_setting()};mst.firmware_view_convert=function(n){if(n.length!=6)return n;var t="";return t+=parseInt(n.slice(0,2)),t+=" . "+parseInt(n.slice(2,4)),t+(" . "+parseInt(n.slice(4,6)))};mst.firmware_setting=function(){var n="";n+="<form method='POST' enctype='multipart/form-data' id='firmware_form'>";n+="<b style='font-size: 30px;'>ファームウェア<\/b><br><br>";n+="<b>バージョン：<\/b><br>　　<font style='font-size: 40px;'>"+mst.firmware_view_convert(mst.firmware_version)+"<\/font><br><br><br>";n+="<b>ファイル：<\/b><br>";n+="<input type='file' id='firmware_file' name='update' style='font-size: 25px;border: 4px solid black;background-color: #e6f1ff;padding: 12px;width: 500px;'><br><br>";n+="<div id='firmware_btn_box' style='text-align: right;'>";n+="<a href='#' class='update_button' onClick='javascript:mst.firmware_update();return false;'>アップデート<\/a><br><br>";n+="<\/div>";n+="<div id='firmware_info'><\/div>";n+="<br><br><br>";n+="<center>";n+="<div id='firmware_back_btn'>";n+="<a href='#' class='button' onClick='javascript:mst.view_detail_setting();return false;'>キャンセル<\/a>";n+="<\/div>";n+="<\/center>";n+="<\/form>";set_html("setting_box",n);set_html("info_box","");mst.firmware_file_data=null;$("firmware_file").addEventListener("change",n=>{mst.firmware_file_data=n.target.files});mst.view_box(["info_box","setting_box"])};mst.firmware_update=function(){if(!mst.firmware_file_data||!mst.firmware_file_data.length){set_html("firmware_info","bin ファイルを指定して下さい");return}hide("firmware_back_btn");hide("firmware_btn_box");var t=new FormData($("firmware_form")),n=new XMLHttpRequest;n.open("POST","/firmware_update",!0);n.upload.addEventListener("progress",function(n){if(n.lengthComputable){var t=Math.round(n.loaded/n.total*100);t<100?set_html("firmware_info","ファイル送信中： "+t+" %"):set_html("firmware_info","ファームウェア更新中 ...")}});n.addEventListener("error",mst.firmware_update_error);n.upload.addEventListener("abort",mst.firmware_update_error);n.upload.addEventListener("error",mst.firmware_update_error);n.upload.addEventListener("timeout",mst.firmware_update_error);n.onreadystatechange=function(){this.readyState==4&&this.status==200?mst.firmware_update_ok(this):mst.firmware_update_error(null)};n.send(t)};mst.firmware_update_error=function(){set_html("info_box","<b>エラー<\/b><br>ページを閉じて下さい。");mst.browser_btn_control_remove();mst.view_box(["info_box"])};mst.firmware_update_ok=function(){set_html("info_box","<b>アップデート成功<\/b><br>ページを閉じて下さい。");mst.browser_btn_control_remove();mst.view_box(["info_box"])};mst.view_init_setting=function(){var n="";n+="<b style='font-size: 30px;'>設定の初期化<\/b><br><br>";n+="<font style='font-size: 32px;'>全ての設定を出荷時の状態に戻します。<br><br><br>";n+="<font style='color: #ff6347;'>※ 初期化すると元に戻せません。<\/font><\/font><br>";n+="<br><br><br>";n+="<div id='init_setting_info'><\/div>";n+="<center>";n+="<div id='init_setting_menu'>";n+="<a href='#' class='button' onClick='javascript:mst.init_setting();return false;'>初期化する<\/a>　　　";n+="<a href='#' class='button' onClick='javascript:mst.view_detail_setting();return false;'>キャンセル<\/a>";n+="<\/div>";n+="<\/center><br>";set_html("setting_box",n);set_html("info_box","");mst.view_box(["info_box","setting_box"])};mst.init_setting=function(){hide("init_setting_menu");set_html("init_setting_info","初期化中...");ajax("/init_setting_json","text",function(n){if(!n){set_html("init_setting_info","エラー 初期化できませんでした");show("init_setting_menu");return}set_html("init_setting_info","初期化完了しました");mst.browser_btn_control_remove();setTimeout(function(){mst.end_setting(0)},1e3)})}