<html>
<head>
<title>test</title>
<script language="JavaScript" src="./js/jquery-2.1.4.min.js"></script>
<script language="JavaScript" src="./js/jquery-ui.js"></script>
<script language="JavaScript" src="./js/com_serial.js"></script>

</head>
<body>
<br>
JSONを張り付けると表示されます。<br><br>
<textarea id="json_edit" onChange="javascript: kle_view();" style="width: 800px; height: 200px;">
["Esc",{x:1},"F1","F2","F3","F4",{x:0.5},"F5","F6","F7","F8",{x:0.5},"F9","F10","F11","F12",{x:0.25},"PrtSc","Scroll Lock","Pause\nBreak"],
[{y:0.5},"?\n`","!\n1","\"\n2","?\n3","$\n4","%\n5","^\n6","&\n7","*\n8","(\n9",")\n0","_\n-","+\n=",{w:2},"Backspace",{x:0.25},"Insert","Home","PgUp",{x:0.25},"Num Lock","/","*","-"],
[{w:1.5},"Tab","Q","W","E","R","T","Y","U","I","O","P","{\n[","}\n]",{x:0.25,w:1.25,h:2,w2:1.5,h2:1,x2:-0.25},"Enter",{x:0.25},"Delete","End","PgDn",{x:0.25},"7\nHome","8\n↑","9\nPgUp",{h:2},"+"],
[{w:1.75},"Caps Lock","A","S","D","F","G","H","J","K","L",":\n;","@\n'","~\n#",{x:4.75},"4\n←","5","6\n→"],
[{w:1.25},"Shift","|\n\\","Z","X","C","V","B","N","M","<\n,",">\n.","?\n/",{w:2.75},"Shift",{x:1.25},"↑",{x:1.25},"1\nEnd","2\n↓","3\nPgDn",{h:2},"Enter"],
[{w:1.25},"Ctrl",{w:1.25},"Win",{w:1.25},"Alt",{a:7,w:6.25},"",{a:4,w:1.25},"AltGr",{w:1.25},"Win",{w:1.25},"Menu",{w:1.25},"Ctrl",{x:0.25},"←","↓","→",{x:0.25,w:2},"0\nIns",".\nDel"]
</textarea><br><br>
<div id="keyboard_view"></div>
<script language="JavaScript">


var kle_view = function() {

  try {
    var tx = $("#json_edit").val();
    tx = tx.replace(/({|,|\s)([\w|\d]{1,3}):/g, "$1\"$2\":")
    var json_data = JSON.parse("[" + tx + "]");

    var serial_data = $serial.deserialize(json_data);

    var str="";

    str += '<div style="position: relative;">\n';

    serial_data.keys.forEach(key => {
      const coef = 50
      if (key.rotation_angle) console.log(key);
      let wrapperStyle = ''
      wrapperStyle += 'user-select: none; position: absolute;'
      wrapperStyle += `transform: rotate(${key.rotation_angle}deg);`
      wrapperStyle += `transform-origin: ${key.rotation_x * coef}px ${key.rotation_y * coef}px;`
  
      let innerStyle = '';
      innerStyle += 'user-select: none; border-style: solid; border-radius: 5px;';
      innerStyle += 'border-width: 1px;';
      innerStyle += 'position: absolute;';
      innerStyle += `left: ${( key.x) * coef}px;`
      innerStyle += `top: ${( key.y) * coef}px;`
      innerStyle += `width: ${key.width * coef - 4}px;`
      innerStyle += `height: ${key.height * coef - 4}px;`

      const label = key.labels[0] || '';

      str += "<div style='" + wrapperStyle + "'>\n";
      str += "<div style='" + innerStyle + "'><table cellpadding='0' cellspacing='0' style='user-select: none; width: 100%; height: 100%;font-size: 10px;'><tr><td align='center'>" + label + "</td></tr></table></div>\n";
      str += "</div>\n";
    });

    str += "</div>\n";

    $("#keyboard_view").html(str);
  } catch(err) {
    window.err = err;
    $("#keyboard_view").html("error: " + err.message);
  }
};

kle_view();

</script>

</body>
</html>
